import{r as ie,b as oe,h as re,g as ne,e as ce,i as j,l as le,a as c,j as s,F as v,L as f,k as x,p as de}from"./main-sixty-windows-relax.js";import{u as ue,C as D,a as he,t as ge,$ as pe,b as me}from"./CreateScheduleModal-B8Cf6mUI.js";import{u as Se}from"./useDebounce-CUMPPC0U.js";import{C as fe}from"./CronWarning-CxT7V9W3.js";import{u as xe,N as Te}from"./useUpdateScheduleStatus-DO63mtFr.js";import{R as ye,D as be}from"./Refresh-CXkExYDM.js";import{r as T,s as Ce,y as E,F as _e,S as I,T as k,B as y,I as Ae,P as $,m as ve,w as Ie,E as ke,o as F,u as Pe}from"./antd-Biwa_WcY.js";import{u as Ee}from"./router-C23xx3cB.js";import{u as we,a as Me}from"./react-query-DTccfBeP.js";import"./css-in-js-CSGOT-6T.js";import"./index-C5LbIB16.js";import"./useSocialTemplates-BiyAeAy2.js";import"./DatePicker-DXK_nakB.js";import"./isPro-Cd6vIDhm.js";import"./AccountTree-BRMqFSA0.js";import"./PlatformIcon-DQwuZFOE.js";import"./usePostTypes-DclIDgT5.js";import"./ConnectAccount-C_KvEdD2.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,o){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,o),o)}};function Ne(){const t=we(),{mutateAsync:o,isPending:u,isSuccess:g}=Me({mutationFn:async l=>{if(!l.length)throw new Error("Schedule ID is undefined");return ie("schedule/destroy",{scheduleIds:l},void 0,"POST")},onSuccess:()=>{t.invalidateQueries({queryKey:["get-calendar-schedules"]}),t.invalidateQueries({queryKey:["all-schedules"]})}});return{deleteSchedule:l=>o(l),deleteScheduleLoading:u,deleteScheduleSuccess:g}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,o){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,o),o)}};E.extend(he);E.extend(ge);const je=({token:t})=>({color:t.colorSuccessText,background:t.colorSuccessBg,border:`1px solid ${t.colorSuccessBorder}`,borderRadius:"10px",minWidth:"90px"}),De=({token:t})=>({color:t.colorWarningText,background:t.colorWarningBg,border:`1px solid ${t.colorWarningBorder}`,borderRadius:"10px",minWidth:"90px"}),h=1,P=0,L=2;function Xe(){const[t,o]=Ee(),u=Number(t.get("page"))||1,g=Number(t.get("limit"))||10,[l,b]=T.useState({open:!1,type:"Create"}),[C,p]=T.useState([]),R=oe(pe),[w,z]=re(me),d=Se(w,300),{scheduleData:r,totalPages:_,totalSchedule:B,isLoadingSchedules:A,isFetchingSchedules:M,refetchSchedules:S}=ue(d,u,g),{deleteSchedule:N,deleteScheduleLoading:O}=Ne(),{updateScheduleStatus:W}=xe(),[U,q]=Ce.useNotification(),{timeZone:H}=ne(ce),Q=(e,i="success")=>{U[i]({message:"Share Now",description:e})},Y=(e,i)=>{o(a=>(a.set("page",String(e)),a.set("limit",String(i)),a))},K=e=>{const i=r.find(a=>a.id===e);i&&(R(de(i.config,a=>{a.id=i.id})),b({open:!0,type:"Edit"}))},V=e=>{z(e.target.value)},Z=async()=>{await N(C),p([]),S()},G=async e=>{await N([e]),S()},J=async(e,i)=>{const{status:a,data:n}=await W({id:e,status:i});Q(n,a),S()},X=[{title:"Title",dataIndex:"title",key:"title",width:"20%"},{title:"Created At",dataIndex:"created_at",key:"created_at"},{title:"Start Scheduled Post",dataIndex:"start",key:"start"},{title:"Interval ",dataIndex:"interval",key:"interval",render:(e,{interval:i})=>{var a;return(a=i.settings)!=null&&a.post_interval_value?s(k.Text,{children:`${i.settings.post_interval_value}  ${i.settings.post_interval_type}`}):"-"}},{title:"Next Post ",dataIndex:"nextPost",key:"nextPost"},{title:"Status",dataIndex:"status",key:"status",render:(e,{key:i,interval:a,status:n})=>{var m;if(!((m=a.settings)!=null&&m.post_interval_value)&&n===h)return s(F,{color:"green",children:"In Progress"});switch(n){case h:case P:return s(Pe,{size:"small",variant:"borderless",value:n===h?"Active":"Paused",css:n===h?je:De,onChange:se=>J(i,Number(se)),options:[{value:h,label:"Active",disabled:n===h},{value:P,label:"Paused",disabled:n===P}]});case L:return s(F,{color:"grey",children:"Completed"})}}},{title:"Action ",dataIndex:"action",key:"action",render:(e,{key:i,interval:a,status:n})=>{var m;return c(I,{direction:"horizontal",children:[((m=a.settings)==null?void 0:m.post_interval_value)&&n!==L&&s(y,{type:"text",icon:s(f,{name:"pencil"}),onClick:()=>K(i)}),s($,{placement:"right",title:"Delete?",okText:"Yes, Delete",description:"Are you sure you want to delete this schedule?",onConfirm:()=>G(i),okButtonProps:{loading:O,danger:!0},children:s(y,{type:"text",icon:s(f,{name:"trash-2"}),danger:!0})})]})}}],ee=r&&r.map(e=>({key:e.id,title:e.name,status:e.status,interval:e.config,created_at:j(e.created_at,`${x.DATE_FORMAT} ${x.TIME_FORMAT}`),start:e!=null&&e.started_at?j(e.started_at,`${x.DATE_FORMAT} ${x.TIME_FORMAT}`):"-",nextPost:e.next_published_at&&e.status===1&&E(e.next_published_at).diff(le(H))>1?e.human_readable_next_publish:"-"})),te={onSelect:(e,i)=>{if(e){if(i){p(a=>[...a,e.key]);return}p(a=>a.filter(n=>n!==e.key))}},onSelectAll:(e,i)=>{if(e){p(i.map(a=>a==null?void 0:a.key).filter(a=>a!==void 0));return}p([])}},ae=C.length>0;return T.useEffect(()=>{o(e=>(e.set("page",String(u)),e.set("limit",String(g)),e))},[d]),T.useEffect(()=>{!r.length&&_&&u>_&&o(e=>(e.set("page",String(_)),e))},[r]),c(v,{children:[q,c(_e,{className:"mb-1",justify:"space-between",children:[c(I,{children:[!d&&r.length||d?s(Ae,{placeholder:"Search schedule",onChange:V,value:w,prefix:s(f,{name:"search"})}):void 0,ae?c(v,{children:[s(k.Text,{children:`Selected ${C.length} items`}),s($,{title:"Delete Logs",description:"Are you sure to delete this logs?",onConfirm:Z,okText:"Yes, Delete",placement:"right",okButtonProps:{danger:!0},children:s(y,{className:"ml-2",icon:s(be,{}),type:"text",danger:!0})})]}):void 0]}),s("div",{children:!d&&r.length||d?c(I,{children:[c(k.Link,{style:{fontSize:"18px"},href:"https://bit-social.com/docs/schedule-wordpress-posts-on-social-media/",target:"_blank",rel:"noopener noreferrer",strong:!0,children:["How to create schedule"," ",s(f,{name:"move-up-right",style:{transform:"translateY(-2px)"}})]}),s(y,{size:"large",disabled:M,icon:s(ye,{spin:M}),onClick:()=>S(),children:"Refresh"}),s(D,{btnTitle:"Create Schedule",isScheduleModalOpen:l,setIsScheduleModalOpen:b})]}):void 0})]}),A&&s(ve,{}),r!=null&&r.length?c(v,{children:[s(fe,{}),s(Ie,{className:"mt-1",rowSelection:te,columns:X,dataSource:ee,bordered:!0,pagination:{showSizeChanger:!0,onChange:Y,defaultCurrent:1,current:u,pageSize:g,total:B}})]}):void 0,!A&&!(r!=null&&r.length)?s(ke,{description:"No schedule found!",children:!d&&s(D,{btnTitle:"Create Schedule",isScheduleModalOpen:l,setIsScheduleModalOpen:b})}):void 0,!A&&!(r!=null&&r.length)?s(Te,{section:"schedule",style:{marginTop:"30px",textAlign:"justify"},fontSize:"1.6rem"}):void 0]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,o){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,o),o)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(t,o){return this.cache.has(t)?this.cache.get(t):(this.cache.set(t,o),o)}};export{Xe as default};
