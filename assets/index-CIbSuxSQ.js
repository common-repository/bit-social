import{f as Be,r as ie,g as xe,e as _e,b as ze,i as fe,k as te,l as G,a as p,j as a,F as H,L as R,m as We,h as X,u as ue,c as pe,p as j}from"./main-sixty-windows-relax.js";import{r as B,s as ge,y as F,j as Ie,S as $,T as V,P as be,B as I,i as se,w as Ye,E as Ve,m as Qe,o as re,u as de,p as P,K as ee,h as Ke,I as Q,n as qe,H as Je,M as je,J as ye,U as Le,g as Me,v as Ze,F as Ce,N as Ge,O as Xe}from"./antd-Biwa_WcY.js";import{C as Pe}from"./CronWarning-CxT7V9W3.js";import{u as et,N as tt}from"./useUpdateScheduleStatus-DO63mtFr.js";import{D as at,R as st}from"./Refresh-CXkExYDM.js";import{u as De}from"./router-C23xx3cB.js";import{u as Ee,a as me,c as it,k as nt,Q as ot}from"./react-query-DTccfBeP.js";import{u as lt,C as Se}from"./ConnectAccount-C_KvEdD2.js";import{u as ct,A as rt,b as ht}from"./AccountTree-BRMqFSA0.js";import{P as dt}from"./PlatformIcon-DQwuZFOE.js";import{p as we}from"./PreviewDummy-CYDabmOl.js";import{$ as ut,D as pt}from"./DatePicker-DXK_nakB.js";import"./isPro-Cd6vIDhm.js";import"./ProGoogleBusinessProfileSettings-0Wj3owyj.js";import"./css-in-js-CSGOT-6T.js";import"./index-C5LbIB16.js";import"./useMemoDebounce-C5qvmGln.js";import"./useUpdateSocialTemplates-CNTIZaXP.js";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Fe=()=>({settings:{name:"",post_interval_value:1,post_interval_type:"hour",started_at:void 0,repeat:!1},accounts:{accountIds:[],tagIds:[]},platforms:[],templates:{facebook:{content:"",media:[],link:"",isLinkCard:!1,isAllImages:!1,edit:!1},instagram:{content:"",media:[],link:"",isLinkCard:!1,isAllImages:!1,edit:!1},linkedin:{content:"",media:[],link:"",isLinkCard:!1,isAllImages:!1,edit:!1},twitter:{content:"",media:[],link:"",isLinkCard:!1,isAllImages:!1,edit:!1},tumblr:{content:"",media:[],link:"",isLinkCard:!1,isAllImages:!1,edit:!1},pinterest:{content:"",media:[],isAllImages:!1,edit:!1},discord:{content:"",media:[],link:"",isLinkCard:!1,isAllImages:!1,edit:!1},googleBusinessProfile:{content:"",media:[],link:"",isLinkCard:!1,isAllImages:!1,edit:!1,button:"none"},all:{content:"",media:[],link:"",isLinkCard:!1}}}),K=globalThis.jotaiAtomCache.get("/home/runner/work/bit-social/bit-social/frontend/src/common/globalStates/$shareNowData.ts/$shareNowData",Be(Fe()));K.debugLabel="$shareNowData";globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function gt(e,t){const l=Ee(),{mutateAsync:s,isPending:C}=me({mutationFn:async N=>ie("share-now/destroy/batch",{shareNowIds:N},void 0,"POST"),onSuccess:()=>{l.invalidateQueries({queryKey:["share-now",[t,e]]})}});return{deleteShareNow:N=>s(N),isShareNowDeleting:C}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function $e(e,t){const{data:l,refetch:s,isLoading:C,isFetching:N}=it({queryKey:["share-now",[e,t]],queryFn:async()=>ie(`share-now/${e}/${t}`,void 0,void 0,"GET"),enabled:!!t&&!!e,placeholderData:nt}),{data:h,pages:A,per_page:b,total:k,current_total:y,current_page:_}=(l==null?void 0:l.data)||{};return{shareNowData:h||[],totalShareNow:k,currentPage:_,totalPages:A,perPage:b,currentTotal:y,refetchShareNowList:s,isLoadingShareNowList:C,isFetchingShareNowList:N}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const mt=({token:e})=>({color:e.colorSuccessText,background:e.colorSuccessBg,border:`1px solid ${e.colorSuccessBorder}`,borderRadius:"10px",minWidth:"90px"}),ft=({token:e})=>({color:e.colorWarningText,background:e.colorWarningBg,border:`1px solid ${e.colorWarningBorder}`,borderRadius:"10px",minWidth:"90px"}),he=0,J=1,ke=2,bt=3,yt=4;function Ct({setShareNowModal:e}){const[t,l]=De({}),s=Number(t.get("page"))||1,C=Number(t.get("limit"))||10,{timeZone:N}=xe(_e),{shareNowData:h,totalShareNow:A,totalPages:b,refetchShareNowList:k,isLoadingShareNowList:y,isFetchingShareNowList:_}=$e(s,C),[c,n]=B.useState([]),{updateScheduleStatus:d}=et(),{deleteShareNow:r,isShareNowDeleting:v}=gt(C,s),x=ze(K),[D,W]=ge.useNotification(),g=(i,f="success")=>{D[f]({message:"Share Now",description:i})},o=h.map(i=>({key:i.id,title:i.name,status:i.status,interval:i.config,created_at:fe(i.created_at,`${te.DATE_FORMAT} ${te.TIME_FORMAT}`),start:i!=null&&i.config.settings.started_at?fe(i==null?void 0:i.config.settings.started_at,`${te.DATE_FORMAT} ${te.TIME_FORMAT}`):"-",nextPost:i.next_published_at&&i.status===1&&F(i.next_published_at).diff(G(N))>1?i.human_readable_next_publish:"-"})),T=async(i,f)=>{const{status:u,data:O}=await d({id:i,status:f});g(O,u),k()},L=()=>{x(Fe()),e({open:!0,type:"create"})},Y=async i=>{await r([i]),k()},z=i=>{const f=h.find(u=>u.id===i);f&&(x(u=>({...u,id:i,accounts:f.config.accounts,settings:f.config.settings,templates:f.config.templates,status:f.status})),e({open:!0,type:"edit"}))},E=[{title:"Title",dataIndex:"title",key:"title",width:"20%"},{title:"Created At",dataIndex:"created_at",key:"created_at"},{title:"Start Scheduled Post",dataIndex:"start",key:"start"},{title:"Interval ",dataIndex:"interval",key:"interval",render:(i,{interval:f})=>a(V.Text,{children:f.settings.repeat?`${f.settings.post_interval_value} ${f.settings.post_interval_type}`:"-"})},{title:"Next Post ",dataIndex:"nextPost",key:"nextPost"},{title:"Status",dataIndex:"status",key:"status",render:(i,{key:f,status:u})=>{switch(u){case he:case J:return a(de,{size:"small",variant:"borderless",value:u===J?"Active":"Paused",css:u===J?mt:ft,onChange:O=>T(f,Number(O)),options:[{value:J,label:"Active",disabled:u===J},{value:he,label:"Paused",disabled:u===he}]});case ke:return a(re,{color:"grey",children:"Completed"});case yt:return a(re,{color:"red",children:"Missed"});case bt:return a(re,{color:"purple",children:"Draft"})}}},{title:"Action ",dataIndex:"action",key:"action",render:(i,{key:f,status:u})=>p($,{direction:"horizontal",children:[u!==ke&&a(I,{type:"text",icon:a(R,{name:"pencil"}),onClick:()=>z(f)}),a(be,{placement:"right",title:"Delete?",okText:"Yes, Delete",description:"Are you sure you want to delete this schedule?",onConfirm:()=>Y(f),okButtonProps:{loading:v,danger:!0},children:a(I,{type:"text",icon:a(R,{name:"trash-2"}),danger:!0})})]})}],ne=(i,f)=>{l(u=>(u.set("page",String(i)),u.set("limit",String(f)),u))},oe={onSelect:(i,f)=>{if(i){if(f){n(u=>[...u,i.key]);return}n(u=>u.filter(O=>O!==i.key))}},onSelectAll:(i,f)=>{if(i){n(f.map(u=>u==null?void 0:u.key).filter(u=>u!==void 0));return}n([])}},le=c.length>0,ce=async()=>{await r(c),n([]),k()};return B.useEffect(()=>{!h.length&&b&&s>b&&l(i=>(i.set("page",String(b)),i))},[h]),p(H,{children:[W,p(Ie,{justify:"space-between",className:"mb-2",children:[a(se,{children:a($,{children:le?p(H,{children:[a(V.Text,{children:`Selected ${c.length} items`}),a(be,{title:"Delete Logs",description:"Are you sure to delete this logs?",onConfirm:ce,okText:"Confirm",placement:"right",children:a(I,{icon:a(at,{}),type:"text",danger:!0})})]}):void 0})}),a(se,{children:o!=null&&o.length?p($,{children:[p(V.Link,{style:{fontSize:"18px"},rel:"noopener noreferrer",href:"https://bit-social.com/docs/instantly-share-posts-on-social-media-platforms/",target:"_blank",strong:!0,children:["How to share a post instantly"," ",a(R,{name:"move-up-right",style:{transform:"translateY(-2px)"}})]}),a(I,{size:"large",disabled:y||_,icon:a(st,{spin:y||_}),onClick:()=>k(),children:"Refresh"}),a(I,{onClick:L,size:"large",type:"primary",icon:a(R,{name:"plus"}),children:"Share Post"})]}):void 0})]}),o!=null&&o.length?p(H,{children:[a(Pe,{}),a(Ye,{className:"mt-1",rowSelection:oe,columns:E,bordered:!0,dataSource:o,pagination:{showSizeChanger:!0,onChange:ne,defaultCurrent:1,current:s,pageSize:C,total:A}})]}):void 0,!y&&!(o!=null&&o.length)?a(Ve,{description:"No Share Post found!",children:a(I,{size:"large",onClick:L,type:"primary",icon:a(R,{name:"plus"}),children:"Share Post"})}):void 0,y&&a(Qe,{}),!y&&!(o!=null&&o.length)?a(tt,{section:"shareNow",style:{marginTop:"30px",textAlign:"justify"},fontSize:"1.6rem"}):void 0]})}const St=""+new URL("bit-social-369.svg",import.meta.url).href;globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const wt=[{value:"Mon",label:"Monday"},{value:"Tue",label:"Tuesday"},{value:"Wed",label:"Wednesday"},{value:"Thu",label:"Thursday"},{value:"Fri",label:"Friday"},{value:"Sat",label:"Saturday"},{value:"Sun",label:"Sunday"}],{dateFormat:kt,timeFormat:Tt,timeZone:Z}=xe(_e),At=`${kt} ${Tt}`,vt=We(At),{Text:Te}=V;var Nt={name:"z33n32",styles:"max-width:80px"},xt={name:"ypff5m",styles:"min-width:100px"};function _t({isScheduleModal:e,shareNowModalType:t,setScheduleModal:l}){var D,W;const[s,C]=X(K),N=ct(),[h,A]=X(ut),{isProClient:b}=ue(pe),k=F(G(Z)).format("YYYY-MM-DD HH:mm:ss"),y=(g,o)=>{C(T=>j(T,L=>{L.settings={...L.settings,[g]:o}}))},_=()=>{var g;if((g=h==null?void 0:h.startedAt)!=null&&g.length){ge.error({message:h.startedAt,placement:"topRight"});return}l(!1)},c=g=>o=>{const T=F(G(Z)).format("YYYY-MM-DD"),L=F(o).format("HH:mm:ss");if(!o){A(E=>({...E,startedAt:""})),y(g,"");return}const z=(b?o:F(T+L)).format("YYYY-MM-DD HH:mm:ss");if(o&&F(o).diff(G(Z))<1){A(E=>({...E,startedAt:"Start date & time must be grater than local time"})),y(g,z);return}z&&(A(E=>({...E,startedAt:""})),y(g,z))},n=g=>o=>{y(g,o)},d=g=>{const{name:o,value:T}=g.target;y(o,T)},r=g=>(o,T)=>{if(o===null){C(L=>j(L,Y=>{delete Y.settings.sleep_time}));return}y(g,T)},v=g=>{var o;g||((o=h==null?void 0:h.startedAt)!=null&&o.length&&A(T=>({...T,startedAt:""})),y("started_at",""))};return a(je,{title:t==="edit"?"Edit schedule":"Schedule",open:e,onCancel:_,okButtonProps:{style:{display:"none"}},width:580,maskClosable:!1,centered:!0,footer:[a(I,{onClick:()=>{var g;C(o=>j(o,T=>{T.settings={...T.settings,post_interval_value:1,post_interval_type:"hour",started_at:void 0,repeat:!1},delete T.settings.sleep_time,delete T.settings.sleep_days})),(g=h==null?void 0:h.startedAt)!=null&&g.length&&A(o=>({...o,startedAt:""}))},children:"Reset"},"reset"),a(I,{type:"primary",onClick:_,children:"Continue"},"continue")],children:p(P,{layout:"vertical",children:[a(P.Item,{label:"Start date & time",children:p($,{direction:"vertical",children:[a(pt,{onChangeDate:c,stateData:s,handleOnClear:v,type:"SHARENOW"}),h.startedAt&&p(Te,{type:"danger",children:[h.startedAt," "]}),p(Te,{mark:!0,children:["Local time: ",F(k).format(vt),"; Time Zone: (",Z,")"]})]})}),p($,{className:"fw-sb pb-2",children:[a(ee,{placement:"bottomLeft",title:"Please, insert a valid start date & time first!",children:a(Ke,{size:"small",disabled:!s.settings.started_at,value:s.settings.repeat,defaultChecked:s.settings.repeat,onChange:g=>y("repeat",g)})}),"Repeat"]}),a(P.Item,{label:"Post interval",style:{margin:"10px 0"},children:p($,{children:[a(Q,{disabled:!s.settings.repeat,css:Nt,type:"number",min:1,name:"post_interval_value",onChange:d,value:s.settings.post_interval_value}),a(de,{disabled:!s.settings.repeat,value:s.settings.post_interval_type,onChange:n("post_interval_type"),options:N,css:xt})]})}),s.id&&s.settings.started_at&&F(s.settings.started_at).diff(G(Z))<1&&a(qe,{message:p(H,{children:["If your start time has passed, updating the interval will set your next post to local time plus the new interval! For example, current time 06:00 PM, updated Post interval: 2 hours. Next post will be at 08:00 PM."," ",a(V.Link,{href:"https://bit-social.com/docs/bit-social/instantly-share-posts-on-social-media-platforms/#if-you-update-your-post-interval",target:"_blank",rel:"noopener noreferrer",underline:!0,children:"Visit our documentation"})]}),type:"info",showIcon:!0}),a(P.Item,{label:"Set a sleep timer",children:a(Je.RangePicker,{disabled:!s.settings.repeat,onChange:r("sleep_time"),format:"HH:mm",value:(D=s.settings.sleep_time)!=null&&D[0]&&((W=s.settings.sleep_time)!=null&&W[1])?[F(s.settings.sleep_time[0],"HH:mm"),F(s.settings.sleep_time[1],"HH:mm")]:void 0})}),a(P.Item,{label:"Set sleep days",children:a(de,{disabled:!s.settings.repeat,placeholder:"Select sleep days",mode:"multiple",allowClear:!0,value:s.settings.sleep_days,onChange:n("sleep_days"),options:wt})})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function It(){const e=new ot,{mutateAsync:t,isPending:l,isSuccess:s}=me({mutationFn:async C=>ie("share-now",{...C},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["all-schedules"]}),e.invalidateQueries({queryKey:["get-calendar-schedules"]}),e.invalidateQueries({queryKey:["share-now"]})}});return{createShareNow:t,isCreateShareNowLoading:l,isShareNowSuccess:s}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function jt(){const e=Ee(),{mutateAsync:t,isPending:l}=me({mutationFn:async s=>ie(`share-now/${s.id}/update`,{...s},void 0,"POST"),onSuccess:()=>{e.invalidateQueries({queryKey:["share-now",[1,10]]})}});return{updateShareNow:t,isUpdateShareNowLoading:l}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Lt=(e,t=[])=>{const l=e.filter(C=>t.includes(C.id)).map(C=>C.platform);return[...new Set(l)]},Ae=e=>{for(const t in e)if(e.hasOwnProperty(t)){const l=e[t];if(l.text||l.media.length)return!0}return!1};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const He=e=>({url:e.url,uid:e.id,name:e.filename});globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Oe({templateData:e,handleCheckBox:t,type:l}){return p(H,{children:[l.includes("isLinkCard")&&a(ee,{title:"Enable to the link shared as a card",children:a(ye,{checked:e.isLinkCard,onChange:s=>{t("isLinkCard",s.target.checked)},children:"Link"})}),l.includes("isAllImages")&&a(ee,{title:"Enable to selected image shared",children:a(ye,{checked:e.isAllImages,onChange:s=>{t("isAllImages",s.target.checked)},children:"Media"})})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Mt=3e3;function Pt(){var k,y,_;const[e,t]=X(K),{isProClient:l}=ue(pe),s=["isLinkCard","isAllImages"],C=c=>{t(n=>j(n,d=>{d.templates.facebook.content=c.target.value}))},N=(c,n)=>{t(d=>j(d,r=>{r.templates.facebook.isLinkCard=!1,r.templates.facebook.isAllImages=!1,r.templates.facebook[c]=n}))},h=c=>{const{value:n}=c.target;t(d=>j(d,r=>{r.templates.facebook.link=n}))},A=({fileList:c})=>{const n=j(e,d=>{d.templates.facebook.media=c});t(n)},b=()=>{const c=["image/jpg","image/jpeg","image/png","image/webp"];if(typeof wp<"u"&&wp.media){const n=wp.media({title:"Media",button:{text:"Select Image"},library:{type:c},multiple:l?"add":!1}),d=e.templates.facebook.media.map(r=>r.uid);n.on("open",()=>{const r=n.state().get("selection");d.forEach(v=>{const x=wp.media.attachment(v);x.fetch().done(()=>{r.add(x)})})}),n.on("select",()=>{const r=n.state().get("selection").toJSON();let v=[];v=r.map(D=>He(D));const x=v.at(-1)||{};A({file:x,fileList:v})}),n.open()}};return a(Me,{children:p(P,{layout:"vertical",children:[a(P.Item,{htmlFor:"textBox",label:"Post",children:a(Q.TextArea,{id:"textBox",value:e.templates.facebook.content,style:{height:120,resize:"none"},maxLength:Mt,onChange:c=>C(c),placeholder:"Write your custom post",showCount:!0})}),a($,{className:"py-2",children:a(Oe,{type:s,templateData:e.templates.facebook,handleCheckBox:N})}),((k=e.templates.facebook)==null?void 0:k.isLinkCard)&&a(P.Item,{htmlFor:"link",label:"Link",children:a(Q,{value:e.templates.facebook.link,id:"link",placeholder:"https://example.com",onChange:c=>h(c)})}),!((y=e.templates.facebook)!=null&&y.isLinkCard)&&((_=e.templates.facebook)==null?void 0:_.isAllImages)&&a(Le,{listType:"picture-card",fileList:e.templates.facebook.media,openFileDialogOnClick:!1,onChange:A,children:a(ee,{title:"Add Image",placement:"right",children:a(I,{style:{width:"100%",height:"100%"},onClick:b,children:p($,{direction:"vertical",children:[a(R,{name:"upload",size:20}),"Upload"]})})})})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Dt=3e3;function Et(){var k,y,_;const[e,t]=X(K),{isProClient:l}=ue(pe),s=["isLinkCard","isAllImages"],C=c=>{t(n=>j(n,d=>{d.templates.linkedin.content=c.target.value}))},N=(c,n)=>{t(d=>j(d,r=>{r.templates.linkedin.isLinkCard=!1,r.templates.linkedin.isAllImages=!1,r.templates.linkedin[c]=n}))},h=c=>{const{value:n}=c.target;t(d=>j(d,r=>{r.templates.linkedin.link=n}))},A=({fileList:c})=>{const n=j(e,d=>{d.templates.linkedin.media=c});t(n)},b=()=>{const c=["image/jpg","image/jpeg","image/png","image/webp"];if(typeof wp<"u"&&wp.media){const n=wp.media({title:"Media",button:{text:"Select Image"},library:{type:c},multiple:l?"add":!1}),d=e.templates.linkedin.media.map(r=>r.uid);n.on("open",()=>{const r=n.state().get("selection");d.forEach(v=>{const x=wp.media.attachment(v);x.fetch().done(()=>{r.add(x)})})}),n.on("select",()=>{const r=n.state().get("selection").toJSON();let v=[];v=r.map(D=>He(D));const x=v.at(-1)||{};A({file:x,fileList:v})}),n.open()}};return a(Me,{children:p(P,{layout:"vertical",children:[a(P.Item,{htmlFor:"textBox",label:"Post",children:a(Q.TextArea,{id:"textBox",value:e.templates.linkedin.content,style:{height:120,resize:"none"},maxLength:Dt,onChange:c=>C(c),placeholder:"Write your custom post",showCount:!0})}),a($,{className:"py-2",children:a(Oe,{type:s,templateData:e.templates.linkedin,handleCheckBox:N})}),((k=e.templates.linkedin)==null?void 0:k.isLinkCard)&&a(P.Item,{htmlFor:"link",label:"Link",children:a(Q,{value:e.templates.linkedin.link,id:"link",placeholder:"https://example.com",onChange:c=>h(c)})}),!((y=e.templates.linkedin)!=null&&y.isLinkCard)&&((_=e.templates.linkedin)==null?void 0:_.isAllImages)&&a(Le,{listType:"picture-card",fileList:e.templates.linkedin.media,openFileDialogOnClick:!1,onChange:A,children:a(ee,{title:"Add Image",placement:"right",children:a(I,{style:{width:"100%",height:"100%"},onClick:b,children:p($,{direction:"vertical",children:[a(R,{name:"upload",size:20}),"Upload"]})})})})]})})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function Ft({platform:e}){switch(e){case"facebook":return a(Pt,{});case"linkedin":return a(Et,{})}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};function $t({platform:e}){return a(Ft,{platform:e})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const ae=(e,t="success")=>{ge[t]({message:"Share Now",description:e,duration:3})},ve=(e,t)=>{const l=e[t];return!(!e.media.length&&!(l!=null&&l.length))};function Ht({shareNowModalClose:e,shareNowModalType:t}){var O;const[l,s]=B.useState(!1),[C,N]=B.useState(),[h,A]=B.useState({}),[b,k]=X(K),{createShareNow:y,isCreateShareNowLoading:_}=It(),{updateShareNow:c,isUpdateShareNowLoading:n}=jt(),{accounts:d}=lt(),[r,v]=Ze.useMessage(),[x]=De({}),D=Number(x.get("page"))||1,W=Number(x.get("limit"))||10,{refetchShareNowList:g}=$e(D,W),o=!!Object.keys(h).length||!1,T=()=>{s(!0)},L=B.useMemo(()=>{const m=Lt(d,b.accounts.accountIds),w=m.map(S=>({label:a("span",{title:S,children:a(dt,{name:S,size:32})}),key:S,children:a($t,{platform:S})}));return N(m[0]),k(S=>j(S,U=>{U.platforms=m})),w},[b.accounts.accountIds,d.length]),Y=m=>k(w=>j(w,S=>{S.accounts={accountIds:m.accountIds,tagIds:m.tagIds}})),z=(m,w)=>{const S=[],{platforms:U}=m,Ue=U.length===1;if(m.platforms.length>1&&U.map(q=>{const{requirement:M}=w[q];if(!ve(m.templates[q],M==null?void 0:M.type))return S.push(!0),r.open({type:"error",content:M==null?void 0:M.message})}),Ue){const q=U[0],{requirement:M}=w[q];ve(m.templates[q],M==null?void 0:M.type)||(S.push(!0),r.open({type:"error",content:M==null?void 0:M.message}))}return S.length&&!0||!1},E=m=>{const{name:w}=m.settings;return w===""?(r.open({type:"error",content:"Name empty"}),!0):(h&&Ae(h),!!(we&&z(m,we)))},ne=async()=>{if(!E(b)){if(Ae(h),t==="edit"){const{status:w,data:S}=await c(b);ae(S,w)}else{const{status:w,data:S}=await y(b);g(),ae(S,w)}e()}},oe=m=>{k({...b}),N(m)},le=m=>{const{value:w}=m.target;k(S=>j(S,U=>{U.settings={...U.settings,name:w}}))},ce=async()=>{if(!E(b)){if(t==="edit"){const{status:w,data:S}=await c({...b,isDraft:!0});g(),ae(S,w)}else{const{status:w,data:S}=await y({...b,isDraft:!0});g(),ae(S,w)}e()}},i=()=>Object.keys(h).map(m=>{const{text:w}=h[m];return p("div",{children:[" ",p("p",{children:[a("b",{children:m}),": ",w]})]},m)}),f=()=>a("div",{children:i()});B.useEffect(()=>()=>{A({})},[]);const u=()=>{var m;return t==="edit"?"Update & Publish":(m=b.settings.started_at)!=null&&m.length?"Create":"Publish Now"};return p(H,{children:[v,p(Ie,{gutter:20,children:[p(se,{span:7,children:[p(Ce,{justify:"space-between",className:"mb-1",children:[a(V.Title,{level:5,children:"Accounts"}),d.length?a(Se,{}):""]}),d!=null&&d.length&&b.accounts?a(rt,{selectedAccount:b.accounts,setSelectedAccount:Y}):p(H,{children:[a(ht,{iconSize:40,textLevel:5}),a("div",{style:{textAlign:"center"},children:a(Se,{})})]})]}),a(se,{span:17,children:a("div",{style:{minHeight:"100%"},children:L&&L.length?p(H,{children:[a("div",{children:a(P,{layout:"vertical",children:a(P.Item,{htmlFor:"name",label:"Name",children:a(Q,{id:"name",onChange:le,value:(O=b.settings)==null?void 0:O.name,placeholder:`Untitled Share Now
                    `})})})}),a(Ge,{size:"small",tabBarGutter:2,onChange:oe,activeKey:C,items:L}),p(Ce,{className:"mt-3",justify:"end",gap:8,align:"center",children:[Object.keys(h).length?a(Xe,{defaultOpen:!0,content:f(),title:"Something went wrong!",trigger:"click",children:a(I,{type:"primary",danger:!0,icon:a(R,{name:"loader-circle"})})}):"",a("div",{className:"pr-2",children:a(Pe,{type:"message"})}),a(I,{type:"dashed",disabled:o,onClick:ce,children:"Save as draft"}),a(I,{disabled:o,onClick:T,children:t==="edit"?"Edit Schedule":"Setup Schedule"}),a(I,{type:"primary",disabled:o,loading:_||n,onClick:()=>ne(),children:u()})]})]}):a("img",{src:St,alt:"account select",className:"w-100"})})})]}),l&&a(_t,{isScheduleModal:l,shareNowModalType:t,setScheduleModal:s})]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};const Ne={open:!1,type:void 0};function sa(){const[e,t]=B.useState(Ne),l=()=>{t(Ne)};return p(H,{children:[a(Ct,{setShareNowModal:t}),e.open?a(je,{maskClosable:!1,width:"70%",title:e.type==="edit"?"Edit Share Now":"Share Now",onCancel:l,open:e.open,styles:{body:{padding:0,height:"calc(100vh - 140px)",overflow:"auto",marginInline:-24}},footer:!1,centered:!0,children:a("div",{style:{paddingInline:24},children:a(Ht,{shareNowModalClose:l,shareNowModalType:e.type})})}):""]})}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,t){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,t),t)}};export{sa as default};
